<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/bookcar/view/NotificationsActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/bookcar/view/NotificationsActivity.java" />
              <option name="originalContent" value="package com.example.bookcar.view;&#10;&#10;import static com.example.bookcar.view.bottomtab.TabUtils.setupTabClientUI;&#10;import static com.example.bookcar.view.bottomtab.TabUtils.setupTabDriverUI;&#10;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.View;&#10;import android.view.animation.Animation;&#10;import android.view.animation.AnimationUtils;&#10;import android.view.animation.LayoutAnimationController;&#10;import android.widget.ListView;&#10;&#10;import androidx.activity.EdgeToEdge;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.core.graphics.Insets;&#10;import androidx.core.view.ViewCompat;&#10;import androidx.core.view.WindowInsetsCompat;&#10;&#10;import com.example.bookcar.R;&#10;import com.example.bookcar.adapter.NotificationAdapter;&#10;import com.example.bookcar.model.Notification;&#10;import com.example.bookcar.model.roles.ClientRole;&#10;import com.example.bookcar.model.roles.DriverRole;&#10;import com.example.bookcar.model.roles.UserRole;&#10;import com.example.bookcar.view.animations.FadeIn;&#10;import com.example.bookcar.view.bottomtab.TabUtils;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;import com.google.firebase.firestore.FirebaseFirestore;&#10;import com.google.firebase.firestore.Query;&#10;import com.google.firebase.firestore.QueryDocumentSnapshot;&#10;&#10;import java.util.ArrayList;&#10;&#10;public class NotificationsActivity extends AppCompatActivity {&#10;    private ListView listViewNotification;&#10;    private NotificationAdapter notificationAdapter;&#10;    private ArrayList&lt;Notification&gt; notificationList;&#10;&#10;    private FirebaseAuth mAuth;&#10;    private FirebaseFirestore db;&#10;    private UserRole userRole;&#10;    private boolean isDriverMode = false;&#10;&#10;    private View bottomNavigation, bottomNavigationDriver;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        EdgeToEdge.enable(this);&#10;        setContentView(R.layout.activity_notifications);&#10;        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -&gt; {&#10;            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());&#10;            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);&#10;            return insets;&#10;        });&#10;&#10;        mAuth = FirebaseAuth.getInstance();&#10;        db = FirebaseFirestore.getInstance();&#10;&#10;        // Get driver mode flag from Intent&#10;        isDriverMode = getIntent().getBooleanExtra(&quot;isDriverMode&quot;, false);&#10;        Log.d(&quot;NotificationsActivity&quot;, &quot;isDriverMode: &quot; + isDriverMode);&#10;&#10;        bottomNavigation = findViewById(R.id.bottomNavigation);&#10;        bottomNavigationDriver = findViewById(R.id.bottomNavigationDriver);&#10;&#10;        listViewNotification = findViewById(R.id.lvNotification);&#10;        notificationList = new ArrayList&lt;&gt;();&#10;        notificationAdapter = new NotificationAdapter(this, R.layout.layout_listview_notification, notificationList);&#10;        listViewNotification.setAdapter(notificationAdapter);&#10;&#10;        FadeIn fadeIn = new FadeIn(this);&#10;        fadeIn.fadeIn(listViewNotification);&#10;&#10;        determineUserRole();&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        // Always setup UI based on isDriverMode flag, regardless of userRole&#10;        if (isDriverMode) {&#10;            TabUtils.setupTabDriverUI(this);&#10;            bottomNavigation.setVisibility(View.GONE);&#10;            bottomNavigationDriver.setVisibility(View.VISIBLE);&#10;        } else {&#10;            TabUtils.setupTabClientUI(this);&#10;            bottomNavigation.setVisibility(View.VISIBLE);&#10;            bottomNavigationDriver.setVisibility(View.GONE);&#10;        }&#10;    }&#10;&#10;    private void determineUserRole() {&#10;        String userId = mAuth.getCurrentUser().getUid();&#10;&#10;        // Check user's role from unified users collection&#10;        db.collection(&quot;users&quot;)&#10;                .document(userId)&#10;                .get()&#10;                .addOnCompleteListener(task -&gt; {&#10;                    if (task.isSuccessful() &amp;&amp; task.getResult().exists()) {&#10;                        String roleId = task.getResult().getString(&quot;role_id&quot;);&#10;                        Log.d(&quot;NotificationsActivity&quot;, &quot;User role_id: &quot; + roleId);&#10;&#10;                        if (&quot;driver&quot;.equals(roleId)) {&#10;                            userRole = new DriverRole();&#10;                        } else {&#10;                            userRole = new ClientRole();&#10;                        }&#10;&#10;                        // Setup UI based on isDriverMode flag&#10;                        Log.d(&quot;NotificationsActivity&quot;, &quot;Setting up UI with isDriverMode: &quot; + isDriverMode);&#10;                        if (isDriverMode) {&#10;                            setupTabDriverUI(this);&#10;                            bottomNavigation.setVisibility(View.GONE);&#10;                            bottomNavigationDriver.setVisibility(View.VISIBLE);&#10;                            Log.d(&quot;NotificationsActivity&quot;, &quot;Driver UI setup completed&quot;);&#10;                        } else {&#10;                            setupTabClientUI(this);&#10;                            bottomNavigation.setVisibility(View.VISIBLE);&#10;                            bottomNavigationDriver.setVisibility(View.GONE);&#10;                            Log.d(&quot;NotificationsActivity&quot;, &quot;Client UI setup completed&quot;);&#10;                        }&#10;&#10;                        fetchNotificationInfo(userId);&#10;                    } else {&#10;                        Log.d(&quot;role&quot;, &quot;User not found&quot;);&#10;                    }&#10;                });&#10;    }&#10;&#10;    private void fetchNotificationInfo(String userId) {&#10;        if (userRole == null) {&#10;            Log.e(&quot;Notifications&quot;, &quot;User role is null, cannot fetch notifications&quot;);&#10;            return;&#10;        }&#10;&#10;        db.collection(&quot;notifications&quot;)&#10;                .document(userRole.getCollectionName())&#10;                .collection(userRole.getCollectionName())&#10;                .document(userId)&#10;                .collection(&quot;messages&quot;)&#10;                .orderBy(&quot;timestamp&quot;, Query.Direction.DESCENDING)&#10;                .get()&#10;                .addOnCompleteListener(task -&gt; {&#10;                    if (task.isSuccessful()) {&#10;                        notificationList.clear();&#10;                        for (QueryDocumentSnapshot document : task.getResult()) {&#10;                            String title = document.getString(&quot;title&quot;);&#10;                            String message = document.getString(&quot;message&quot;);&#10;                            String imageName = document.getString(&quot;image&quot;);&#10;                            Boolean read = document.getBoolean(&quot;read&quot;);&#10;&#10;                            Notification notification = new Notification(title, message, imageName, read != null ? read : false);&#10;                            notificationList.add(notification);&#10;                        }&#10;                        notificationAdapter.notifyDataSetChanged();&#10;                    } else {&#10;                        Log.d(&quot;Notifications&quot;, &quot;Error getting notifications: &quot;, task.getException());&#10;                    }&#10;                });&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.bookcar.view;&#10;&#10;import static com.example.bookcar.view.bottomtab.TabUtils.setupTabClientUI;&#10;import static com.example.bookcar.view.bottomtab.TabUtils.setupTabDriverUI;&#10;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.View;&#10;import android.view.animation.Animation;&#10;import android.view.animation.AnimationUtils;&#10;import android.view.animation.LayoutAnimationController;&#10;import android.widget.ListView;&#10;&#10;import androidx.activity.EdgeToEdge;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.core.graphics.Insets;&#10;import androidx.core.view.ViewCompat;&#10;import androidx.core.view.WindowInsetsCompat;&#10;&#10;import com.example.bookcar.R;&#10;import com.example.bookcar.adapter.NotificationAdapter;&#10;import com.example.bookcar.model.Notification;&#10;import com.example.bookcar.model.roles.ClientRole;&#10;import com.example.bookcar.model.roles.DriverRole;&#10;import com.example.bookcar.model.roles.UserRole;&#10;import com.example.bookcar.view.animations.FadeIn;&#10;import com.example.bookcar.view.bottomtab.TabUtils;&#10;import com.google.firebase.auth.FirebaseAuth;&#10;import com.google.firebase.firestore.FirebaseFirestore;&#10;import com.google.firebase.firestore.Query;&#10;import com.google.firebase.firestore.QueryDocumentSnapshot;&#10;&#10;import java.util.ArrayList;&#10;&#10;public class NotificationsActivity extends AppCompatActivity {&#10;    private ListView listViewNotification;&#10;    private NotificationAdapter notificationAdapter;&#10;    private ArrayList&lt;Notification&gt; notificationList;&#10;&#10;    private FirebaseAuth mAuth;&#10;    private FirebaseFirestore db;&#10;    private UserRole userRole;&#10;    private boolean isDriverMode = false;&#10;&#10;    private View bottomNavigation, bottomNavigationDriver;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        EdgeToEdge.enable(this);&#10;        setContentView(R.layout.activity_notifications);&#10;        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -&gt; {&#10;            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());&#10;            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);&#10;            return insets;&#10;        });&#10;&#10;        mAuth = FirebaseAuth.getInstance();&#10;        db = FirebaseFirestore.getInstance();&#10;&#10;        // Get driver mode flag from Intent&#10;        isDriverMode = getIntent().getBooleanExtra(&quot;isDriverMode&quot;, false);&#10;        Log.d(&quot;NotificationsActivity&quot;, &quot;isDriverMode: &quot; + isDriverMode);&#10;&#10;        bottomNavigation = findViewById(R.id.bottomNavigation);&#10;        bottomNavigationDriver = findViewById(R.id.bottomNavigationDriver);&#10;&#10;        listViewNotification = findViewById(R.id.lvNotification);&#10;        notificationList = new ArrayList&lt;&gt;();&#10;        notificationAdapter = new NotificationAdapter(this, R.layout.layout_listview_notification, notificationList);&#10;        listViewNotification.setAdapter(notificationAdapter);&#10;&#10;        FadeIn fadeIn = new FadeIn(this);&#10;        fadeIn.fadeIn(listViewNotification);&#10;&#10;        determineUserRole();&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        // Always setup UI based on isDriverMode flag, regardless of userRole&#10;        if (isDriverMode) {&#10;            TabUtils.setupTabDriverUI(this);&#10;            bottomNavigation.setVisibility(View.GONE);&#10;            bottomNavigationDriver.setVisibility(View.VISIBLE);&#10;        } else {&#10;            TabUtils.setupTabClientUI(this);&#10;            bottomNavigation.setVisibility(View.VISIBLE);&#10;            bottomNavigationDriver.setVisibility(View.GONE);&#10;        }&#10;    }&#10;&#10;    private void determineUserRole() {&#10;        String userId = mAuth.getCurrentUser().getUid();&#10;&#10;        // Check user's role from unified users collection&#10;        db.collection(&quot;users&quot;)&#10;                .document(userId)&#10;                .get()&#10;                .addOnCompleteListener(task -&gt; {&#10;                    if (task.isSuccessful() &amp;&amp; task.getResult().exists()) {&#10;                        String roleId = task.getResult().getString(&quot;role_id&quot;);&#10;                        Log.d(&quot;NotificationsActivity&quot;, &quot;User role_id: &quot; + roleId);&#10;&#10;                        if (&quot;driver&quot;.equals(roleId)) {&#10;                            userRole = new DriverRole();&#10;                        } else {&#10;                            userRole = new ClientRole();&#10;                        }&#10;&#10;                        // Setup UI based on isDriverMode flag&#10;                        Log.d(&quot;NotificationsActivity&quot;, &quot;Setting up UI with isDriverMode: &quot; + isDriverMode);&#10;                        if (isDriverMode) {&#10;                            setupTabDriverUI(this);&#10;                            bottomNavigation.setVisibility(View.GONE);&#10;                            bottomNavigationDriver.setVisibility(View.VISIBLE);&#10;                            Log.d(&quot;NotificationsActivity&quot;, &quot;Driver UI setup completed&quot;);&#10;                        } else {&#10;                            setupTabClientUI(this);&#10;                            bottomNavigation.setVisibility(View.VISIBLE);&#10;                            bottomNavigationDriver.setVisibility(View.GONE);&#10;                            Log.d(&quot;NotificationsActivity&quot;, &quot;Client UI setup completed&quot;);&#10;                        }&#10;&#10;                        fetchNotificationInfo(userId);&#10;                    } else {&#10;                        Log.d(&quot;role&quot;, &quot;User not found&quot;);&#10;                    }&#10;                });&#10;    }&#10;&#10;    private void fetchNotificationInfo(String userId) {&#10;        if (userRole == null) {&#10;            Log.e(&quot;Notifications&quot;, &quot;User role is null, cannot fetch notifications&quot;);&#10;            return;&#10;        }&#10;&#10;        // Determine notification collection name based on role&#10;        String notificationCollection = isDriverMode ? &quot;drivers&quot; : &quot;users&quot;;&#10;        &#10;        Log.d(&quot;Notifications&quot;, &quot;Fetching notifications from collection: &quot; + notificationCollection + &quot; for userId: &quot; + userId);&#10;&#10;        db.collection(&quot;notifications&quot;)&#10;                .document(notificationCollection)&#10;                .collection(notificationCollection)&#10;                .document(userId)&#10;                .collection(&quot;messages&quot;)&#10;                .orderBy(&quot;timestamp&quot;, Query.Direction.DESCENDING)&#10;                .get()&#10;                .addOnCompleteListener(task -&gt; {&#10;                    if (task.isSuccessful()) {&#10;                        notificationList.clear();&#10;                        Log.d(&quot;Notifications&quot;, &quot;Successfully fetched &quot; + task.getResult().size() + &quot; notifications&quot;);&#10;                        for (QueryDocumentSnapshot document : task.getResult()) {&#10;                            String title = document.getString(&quot;title&quot;);&#10;                            String message = document.getString(&quot;message&quot;);&#10;                            String imageName = document.getString(&quot;image&quot;);&#10;                            Boolean read = document.getBoolean(&quot;read&quot;);&#10;&#10;                            Notification notification = new Notification(title, message, imageName, read != null ? read : false);&#10;                            notificationList.add(notification);&#10;                            Log.d(&quot;Notifications&quot;, &quot;Added notification: &quot; + title);&#10;                        }&#10;                        notificationAdapter.notifyDataSetChanged();&#10;                    } else {&#10;                        Log.e(&quot;Notifications&quot;, &quot;Error getting notifications: &quot;, task.getException());&#10;                    }&#10;                });&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>